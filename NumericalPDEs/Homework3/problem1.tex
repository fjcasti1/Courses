\begin{questions}

\question{
For the IVP $du/dt = f(u)$, derive the leading local error term
(including the constant) for TRBDF2 using the definition of the LTE:
\begin{displaymath}
	e_l \approx {\rm LTE} \approx k_\gamma \Delta t^3 u''' ,~~
	k_\gamma = \frac{-3 \gamma^2 ~+~ 4 \gamma ~-~ 2}{12 ( 2 - \gamma )} .
\end{displaymath}
{\em Hint:}\/ Set $u^{n+\gamma} = u(t_{n+\gamma}) - e_l^{TR}$.
{\em Note:}\/ For $u_t = D u_{xx}$, 
\begin{displaymath} 
        \tau = k_\gamma \Delta t^2 u_{ttt} - \frac{h^2 D}{12} u_{xxxx} + \cdots
\end{displaymath}
}
\begin{solution}
We start by substituting $u_{n+\gamma}$ in the \textsl{BDF2} step with the corresponding expression from the \textsl{TR} step, obtaining
\begin{align}
u_{n+1}-\frac{1-\gamma}{2-\gamma}\Delta t_nf_{n+1}=\frac{1}{\gamma(2-\gamma)}\left[u_n+\gamma\frac{\Delta t_n}{2}\left(f_n+f_{n+\gamma}\right)\right]-\frac{(1-\gamma)^2}{\gamma(2-\gamma)}u_n.
\end{align}
Further, taking into account that $f_n=u_n'$, we Taylor expand the following terms:
\begin{itemize}
\item $f_{n+\gamma}$
\begin{align*}
f_{n+\gamma}=u_n'+\gamma\Delta tu_n''+\gamma^2\frac{\Delta t^2}{2} u_n'''+\dots
\end{align*}
\item $f_{n+1}$
\begin{align*}
f_{n+1}=u_n'+\Delta tu_n''+\frac{\Delta t^2}{2} u_n'''+\dots
\end{align*}
\item $u_{n+1}$
\begin{align*}
u_{n+1}=u_n+\Delta tu_n'+\frac{\Delta t^2}{2} u_n''+\frac{\Delta t^3}{6} u_n'''+\dots
\end{align*}
Introducing this terms into equation (1), and truncating the expansions after the third derivatives we obtain
\begin{align*}
u_n+\Delta tu_n'&+\frac{\Delta t^2}{2} u_n''+\frac{\Delta t^3}{6} u_n'''-\frac{1-\gamma}{2-\gamma}\Delta t_n\left(u_n'+\Delta tu_n''+\frac{\Delta t^2}{2} u_n'''\right)\\
&=\frac{1}{\gamma(2-\gamma)}\left[u_n+\gamma\frac{\Delta t_n}{2}\left(u_n'+u_n'+\gamma\Delta tu_n''+\gamma^2\frac{\Delta t^2}{2} u_n'''\right)\right]-\frac{(1-\gamma)^2}{\gamma(2-\gamma)}u_n+e_l.
\end{align*}
Multiplying by $\gamma(2-\gamma)$ we get
\begin{align*}
u_n+\Delta tu_n'&+\frac{\Delta t^2}{2} u_n''+\frac{\Delta t^3}{6} u_n'''-\frac{1-\gamma}{2-\gamma}\Delta t_n\left(u_n'+\Delta tu_n''+\frac{\Delta t^2}{2} u_n'''\right)\\
&=\frac{1}{\gamma(2-\gamma)}\left[u_n+\gamma\frac{\Delta t_n}{2}\left(2u_n'+\gamma\Delta tu_n''+\gamma^2\frac{\Delta t^2}{2} u_n'''\right)\right]-\frac{(1-\gamma)^2}{\gamma(2-\gamma)}u_n+e_l.
\end{align*}
Reorganizing terms:
\begin{align*}
\cancelto{0}{\left[1-\frac{1}{\gamma(2-\gamma)}+\frac{(1-\gamma)^2}{\gamma(2-\gamma)}\right]}u_n&+\cancelto{0}{\left[1-\frac{1-\gamma}{2-\gamma}-\frac{1}{2-\gamma}\right]}\Delta tu_n'\\
&+\cancelto{0}{\left[1-2\frac{1-\gamma}{2-\gamma}-\frac{\gamma}{2-\gamma}\right]}\frac{\Delta t^2}{2} u_n''+\left[1-3\frac{1-\gamma}{2-\gamma}-\frac{3}{2(2-\gamma)}\right]\frac{\Delta t^3}{6} u_n'''=e_l,
\end{align*}
we finally get the desired result
\begin{align*}
e_l=\frac{-3\gamma^2+4\gamma-2}{12(2-\gamma)}\Delta t^3 u_n'''
\end{align*}
\end{itemize}
\end{solution}
\end{questions}
